<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Prototyper un roadbook en JavaScript | Websylvain Développeur web</title>
    <meta name="description" content="Le but de cet exercice est de mettre en avant des trajets sur une carte. La difficulté est ici dans le fait qu&#39;un itinéraire est la représentation d&#39;un ensemble de données géographiques plutôt complexes....">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <meta name="google-site-verification" content="E9stx9fFMrhjIARG8CVHxy_k9azsOf14AIYmH0_Lok0">
    
    <link rel="preload" href="/assets/css/0.styles.e3954a48.css" as="style"><link rel="preload" href="/assets/js/app.be567602.js" as="script"><link rel="preload" href="/assets/js/4.e64471fe.js" as="script"><link rel="preload" href="/assets/js/1.81f9b116.js" as="script"><link rel="preload" href="/assets/js/25.cfb88f80.js" as="script"><link rel="prefetch" href="/assets/js/10.25cdc67b.js"><link rel="prefetch" href="/assets/js/11.c816df3e.js"><link rel="prefetch" href="/assets/js/12.62fcd72b.js"><link rel="prefetch" href="/assets/js/13.20cc0542.js"><link rel="prefetch" href="/assets/js/14.ffd7d726.js"><link rel="prefetch" href="/assets/js/15.d528ba22.js"><link rel="prefetch" href="/assets/js/16.07b4f827.js"><link rel="prefetch" href="/assets/js/17.be608503.js"><link rel="prefetch" href="/assets/js/18.d5d56c5a.js"><link rel="prefetch" href="/assets/js/19.745fda7b.js"><link rel="prefetch" href="/assets/js/2.68b10bcb.js"><link rel="prefetch" href="/assets/js/20.f041c2c3.js"><link rel="prefetch" href="/assets/js/21.0e1474bd.js"><link rel="prefetch" href="/assets/js/22.a18101a6.js"><link rel="prefetch" href="/assets/js/23.9f5915ad.js"><link rel="prefetch" href="/assets/js/24.6dc19d78.js"><link rel="prefetch" href="/assets/js/26.d360cf10.js"><link rel="prefetch" href="/assets/js/27.0a61c248.js"><link rel="prefetch" href="/assets/js/28.8d986b02.js"><link rel="prefetch" href="/assets/js/29.379a1741.js"><link rel="prefetch" href="/assets/js/30.b5f9e1a6.js"><link rel="prefetch" href="/assets/js/31.7f5c1c0e.js"><link rel="prefetch" href="/assets/js/32.d28cb44e.js"><link rel="prefetch" href="/assets/js/33.6ed8baa2.js"><link rel="prefetch" href="/assets/js/34.d9547f45.js"><link rel="prefetch" href="/assets/js/35.d4825f73.js"><link rel="prefetch" href="/assets/js/36.c1bb5d6e.js"><link rel="prefetch" href="/assets/js/37.e742df3a.js"><link rel="prefetch" href="/assets/js/38.3c0bfb5a.js"><link rel="prefetch" href="/assets/js/39.64d0713b.js"><link rel="prefetch" href="/assets/js/40.1539d4f2.js"><link rel="prefetch" href="/assets/js/41.0daac831.js"><link rel="prefetch" href="/assets/js/42.fdca4c9d.js"><link rel="prefetch" href="/assets/js/43.3c09b62e.js"><link rel="prefetch" href="/assets/js/44.9df39f37.js"><link rel="prefetch" href="/assets/js/45.b68c182e.js"><link rel="prefetch" href="/assets/js/46.33847b44.js"><link rel="prefetch" href="/assets/js/47.f7a54077.js"><link rel="prefetch" href="/assets/js/48.701769cf.js"><link rel="prefetch" href="/assets/js/49.c8a55ad8.js"><link rel="prefetch" href="/assets/js/5.9f41dfce.js"><link rel="prefetch" href="/assets/js/6.ebd64e6b.js"><link rel="prefetch" href="/assets/js/7.ddfea93e.js"><link rel="prefetch" href="/assets/js/8.245056f6.js"><link rel="prefetch" href="/assets/js/9.047c252a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e3954a48.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><main class="light"><header><header class="site-header navbar container"><section class="navbar-section"><a href="/" class="navbar-brand navbar-brand_normal mr-2"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAAA8CAYAAAAALGYBAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA/dJREFUeNrsWv9V2zAQVnj5v9qg7gRxJ8CZoNmAdAM6QWECukHoBIQJ4k6AmKBmAsQEqQSG5zr6cSfJCjb3vecXSGRZ/nS67046xggEAoHwUTDzNdjv9yv1URp+up7NZg1R+MzRheFrofjZhnbI1bXb21ER7W9c2XCnebTdd+Lo81xdRHActMe4CiH/lLhLglUI+YQ0sLqdObIjoS7Z/i1demERaS1C0tC+UB9F72up2gpL/xW0b8v9pYuUDhpgUFF3iC5TiMguVGQ1mRiRtjzrDilwFWBcviDChCsEZ5Wpg6xuJ1EIWjqs1gSI1V8FBBHnbbidHEP6fAkl1EaIJUzjlgkXMeLnwdnYyBcY8UFYP48YE898nxNzlhefgOKJnRARaSTdVWoSfzYFy8dGAtCJkRHj/KFc1vL1Uv//zmWJQ5L/lJhgV/LXsBFiSPKbBJYPzbIfiHw/+SbhWiD7LRK7nUmSL4HhI0e6pCKx4E6PfEfcXUa6oslg/g7GwH0pu5rI2hOWprT8OpegD02+MFh29fqCjq0C7CqTCVdsbZmAUfl8iBBCMsfK4+9HGWbmIN9EzOcIf0/kI/DgIRBi+aeu7Ymxhpn/+fz2QGOdOJ72tcfG+KaVch/JwZlDyLfA3VLnKuxVN+gDmuuDqMJzqLDBvpXvcAF4sPHoaX+BGE8INsh33nj622Hdzi81W98HWHkQn8897YdOsNaKsDUiWtI8Xab0+evAOh3bGWyB8PndkJRHusJt4AR8Q1i+HutZSvL1S98kjL+LzgSAnu8oPsJEO5eBAo05TNkw4HnAvGdBdW+J8x4Bb9kmUoQKYNj4Og4OdU+Y82ItnuodvrCXgrCFhdSCBR6mtAZVerJmcUB+q+rLrrixNBVrJvIrh8UKw3N5YDRlW40XDgL1bz8D37WwPHN5rL0diRiosLRfWL4f5W5mriTLFocveplud6LuLT6Xs4nhWOWCHGn5pSW7HbXl53A7AmHJT472paU9kY/0+SUmL3Dcgwkzo2s8x0g+hiBdHFtbyht5LPkKO8N3S5Zp/z67z0fWbTYJVhUJbghJnYmqge0p1AwU3Virp1BzIG0QiSaUyA+wfEgIKcdOfq7SEQiZDzFuynAS99zm4NToEP2TrNOpkd8g20jkZLE2Y+5viGnh9pG/nrrbwZIPaT96t/OeQk2JzA1CBDf0JOt2tORD4nFDmyFCz5CTLAFwXVl8ftmm/jIgwakDrLREWL40PEP0J1iN/2urDQVgDH/YS/GAc8I6gp2m6NdT1rFjhC5XTowhyfpwOKF0/10kmAdLSZd3PJLbiXY7q9BOtcDeqOsvkY8i/7HVzBWxQyAQCATCkfFPgAEAyWyRQU9ABYMAAAAASUVORK5CYII=" alt srcset></a> <a href="/" class="navbar-brand navbar-brand_reverse mr-2"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF8AAAA8CAMAAAA38pYzAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAADNQTFRFAAAAHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eL4wVogAAABF0Uk5TAFCAIBC//0DPn+8wj3Cv32AfqOcxAAACeElEQVR4nO2Y67KjIAyAKYooeHv/p11JgCSoc2qhOzs7Jz86IYYPhIRQlfqVf0JeOkhXDwLOqzD2ZgCx9XwEjb0cdGjMHyZhNM357sv84cwfjfHY7G0QXMIuqNHOzCDeJqHAMGa84dPkO/YyODSbW3ZLQQEyE8z+yFclH709qD45TQMXCsk3+C60Fxpq6C86OsFfn/ChrRkfnr1kR4EfzGP+TM74TLOtSPwjKMz2mD/nHpGvM584eWD9mE89NOODFyVmBX8Pbcf4JnvpFnxyWRkf1nlpwcdI7xWdHAJYzae+7sv8iA+6zS9V+NhQUvZH/DFupT/xL+ZQyDv8FCo28XUMqq0NH86uI9QXxi+WuYqfWKlwBh2Smo6xd/ndsTkQ2Z75LJG5Mn6RXsif4L6geV+sHnnL0xKLipzmkEuIu+EPF71TYTCcP6srPp3xUX/d8Ied9dYXfCdWsgdbxxj+tN4rx/ON8dsFv7hRIKyj/jYNSRhRwFhgjcLkjwrhiqnFs8zi2Fgtz2HX69WYc33BSR12WvJTfMbN3NEVdHt+Sb7cz84fXFyNFRH0dZGUSj70WSHSjGa/TfkG6zzM3EH6yiiu4MNdZNxo5Ycyver4+eA8UopFEc+ifBv9hM8jX3GdJBs+4TOmzOJWfH7yGKa34mfm9mV+qixBRu5Rx8/MSVaxVvzM1OlijmNBvYPShJajYT7h74m5y1sENoyquv8rxrQsGZZ2/Hyz8krc4ogv69fykC/+yG5XfFG/2AeBO/5ivbBFCfoc9QAJ9Q5LUzclH6Mz3trlhn9zuj8U/tp/jT8154tMV51rzS++MPl1a8h3pvyA9Sv/p/wBMvgxt42GTpwAAAAASUVORK5CYII=" alt srcset></a></section> <section class="navbar-section"><a href="mailto:contact@websylvain.com" class="mail">contact@websylvain.com</a> <a class="cd-nav-trigger"><span class="fa fa-bars"></span></a></section></header> <nav class="asideNav"><div class="asideNav-link"><a href="#cd-nav" class="cd-nav-trigger no-scrolled">
                Menu
                <span class="fa fa-bars"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"><circle fill="transparent" stroke="#656e79" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle></svg></a></div> <div id="cd-nav" class="cd-nav"><div class="cd-navigation-wrapper columns"><div class="column col-sm-12 col-6"><h2>Navigation</h2> <nav class="nav-links"><ul class="cd-primary-nav"><li class="nav-item"><a href="/" class="nav-link">Accueil</a></li><li class="nav-item"><a href="/a-propos/" class="nav-link">A propos</a></li><li class="nav-item"><a href="/projects/" class="nav-link">Projets</a></li><li class="nav-item"><a href="/posts/" class="nav-link router-link-active">Les articles</a></li><li class="nav-item"><a href="/contact/" class="nav-link">Contact</a></li></ul></nav></div> <div class="column col-sm-12 col-6"><address><ul class="cd-contact-info"><li><a href="mailto:contact@websylvain.com">contact@websylvain.com</a></li> <li>07 61 74 17 02</li> <li><span>A Carcassonne</span> <span>Dans l'Aude</span> <span>Occitanie, FRANCE</span></li></ul></address></div></div></div></nav></header> <section class="site-content"><div class="bck-page"></div> <section class="container columns toped post"><article class="section column col-lg-12 col-8"><header class="page-header"><h1 class="page-header-title">Prototyper un roadbook en JavaScript</h1></header>  <div class="content default"><p><img src="/assets/img/proto-roadbook.3887cea4.jpg" alt="Prototype de Roadbook"> <a href="http://roadbook.websylvain.com" target="_blank" rel="noopener noreferrer">Voir la démo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ou consulter le <a href="">repository github</a></p> <h1 id="prototyper-un-roadbook-en-javascript"><a href="#prototyper-un-roadbook-en-javascript" aria-hidden="true" class="header-anchor">#</a> Prototyper un roadbook en JavaScript</h1> <p>Le but de cet exercice est d'afficher <strong>des trajets sur une carte leaflet</strong>. La difficulté est dans le fait qu'un itinéraire est la représentation d'un ensemble de données géographiques plutôt complexes (points de passage, distance, temps de parcours...).</p> <p>Pour pouvoir afficher un trajet, il est nécessaire de connaître tous les points qui constituent le chemin. Plus on souhaite obtenir quelque chose de précis plus ses points de passage sont nombreux.</p> <blockquote><p>Bah oue... une route n'est jamais droite, on rencontre de nombreux virages et croisements, il y a aussi des changements de direction. Il faut que votre ligne (le dessin sur la carte) épouse parfaitement les routes, autoroutes, chemins qui existent à l'heure actuelle.</p></blockquote> <h2 id="_1-obtenir-les-donnees-geographiques-d-un-itineraire-entre-plusieurs-points"><a href="#_1-obtenir-les-donnees-geographiques-d-un-itineraire-entre-plusieurs-points" aria-hidden="true" class="header-anchor">#</a> 1 / Obtenir les données géographiques d'un itinéraire entre plusieurs points</h2> <p>En effet, pour obtenir une route parfaite, nous sommes dans l'obligation de passer par ce que l'on appelle une <strong>A.P.I</strong> qui va se charger de calculer le tracé le plus réaliste possible entre les différents points choisis par l' utilisateur.</p> <p>Il en existe un certain nombre dont voici une liste non exhaustive...</p> <ul><li><a href="https://www.mapbox.com/api-documentation/#directions" target="_blank" rel="noopener noreferrer">Directions par MAPBOX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mapquest.com/documentation/directions-api/" target="_blank" rel="noopener noreferrer">Directions par MAPQUEST<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.google.com/maps/documentation/directions/start" target="_blank" rel="noopener noreferrer">Directions par GOOGLE MAP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://project-osrm.org/docs/v5.15.2/api/#route-service" target="_blank" rel="noopener noreferrer">Route service par OSRM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Lorsque vous réalisez une requête (HTTP) à l'une de ces APIs, ces dernières vont vous retourner un json dans lequel vous obtiendrez vos données géographiques (le tracé, la distance à parcourir, le temps nécessaire pour réaliser le trajet etc...).</p> <p>Selon l'API et les paramètres passés à la requête, vous pourrez obtenir les tracés d'un même itinéraire sous deux formes différentes:</p> <ol><li>Un <strong>GéoJson</strong>,  il s'agit d'un tableau dans lequel vous allez retrouver les coordonnées gps des points de passage de votre trajet.</li> <li>Une <strong>Polyline</strong> est une forme géométrique encodée en chaîne de caractère.</li></ol> <div class="tip custom-block"><p class="custom-block-title">Comment faire ?</p> <p>Vous pouvez par exemple utiliser le client http <a href="https://insomnia.rest/" target="_blank" rel="noopener noreferrer">insomnia<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> pour faire la requête et stocker le résultat dans une variable.</p></div> <h4 id="un-trajet-sous-forme-de-geojson-via-mapbox"><a href="#un-trajet-sous-forme-de-geojson-via-mapbox" aria-hidden="true" class="header-anchor">#</a> Un trajet sous forme de geojson ( via Mapbox )</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;geometry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;coordinates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          -<span class="token number">73.98891</span><span class="token punctuation">,</span>
          <span class="token number">40.733122</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
          -<span class="token number">73.994118</span><span class="token punctuation">,</span>
          <span class="token number">40.735313</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
          -<span class="token number">73.996976</span><span class="token punctuation">,</span>
          <span class="token number">40.731414</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>...<span class="token punctuation">]</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LineString&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;legs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;weight_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;routability&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;weight&quot;</span><span class="token operator">:</span> <span class="token number">584.4</span><span class="token punctuation">,</span>
    <span class="token property">&quot;duration&quot;</span><span class="token operator">:</span> <span class="token number">382.6</span><span class="token punctuation">,</span>
    <span class="token property">&quot;distance&quot;</span><span class="token operator">:</span> <span class="token number">1317.9</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="un-trajet-sous-forme-de-polyline-via-osrm"><a href="#un-trajet-sous-forme-de-polyline-via-osrm" aria-hidden="true" class="header-anchor">#</a> Un trajet sous forme de polyline (via OSRM)</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
		<span class="token property">&quot;geometry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uumfGawtOkKqJcB{AQOgD_D][kAcA{HsHsJqIcAsASw@Cg@Rc@VWpDw@HCLCz@QnBQ`J{ApB]x@K\\@^HZPR\\Jb@Bn@Ed@Q^MVSLUFYB]GOISSO_@OeAWaD[gDSw@g@{Gq@uIMcBa@{FSeDU}DUyFIiBG_BIeDIiDGeGCsEAwG?_NB{M?iLBcRBiZBy[ByN@cO@cLAgLEgECaEKyHO}FSyGY{Hc@gKUaGS_GEyBCuBC}DBsDHeFFiBJkCLaCVqDZmDd@mEj@_En@cEfAuGRoAtBgMx@wFp@aFn&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;weight_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;routability&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;weight&quot;</span><span class="token operator">:</span> <span class="token number">5302.2</span><span class="token punctuation">,</span>
		<span class="token property">&quot;duration&quot;</span><span class="token operator">:</span> <span class="token number">4769.9</span><span class="token punctuation">,</span>
		<span class="token property">&quot;distance&quot;</span><span class="token operator">:</span> <span class="token number">67124.9</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>A vous de choisir l'api et le format qui vous conviennent le mieux...</p> <h2 id="_2-leaflet-la-carte"><a href="#_2-leaflet-la-carte" aria-hidden="true" class="header-anchor">#</a> 2 / Leaflet, la carte</h2> <p>On ne présente jamais assez <a href="https://leafletjs.com/" target="_blank" rel="noopener noreferrer">Leaflet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> qui est à mon humble avis la meilleure librairie Javascript pour créer des cartes interactives et &quot;mobile-friendly&quot;. Cette librairie est facile d'utilisation, performante, open source, documentée de la meilleure des manières et possède une très grande communauté d'utilisateurs.</p> <p>Ces nombreux avantages en font la librairie que j'utilise le plus dès qu'il est question de projet avec une dimension S.I.G.</p> <h3 id="une-classe-facilite-l-appel-des-fonctionnalites-de-leaflet"><a href="#une-classe-facilite-l-appel-des-fonctionnalites-de-leaflet" aria-hidden="true" class="header-anchor">#</a> Une classe facilite l'appel des fonctionnalités de Leaflet</h3> <p>Pour faire plus facilement appel aux différentes méthodes de leaflet, j'ai créé une classe qui va se charger de faire interface avec la librairie.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Fichier LeafletMap.class.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">LeafletMap</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_map <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_bounds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Instancier une carte dans l'élément passé en paramètre</span>
  <span class="token function">load</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// --&gt; SET MAP</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_map <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token punctuation">{</span>scrollWheelZoom<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// Pour avoir accès à l'objet map depuis les autres méthodes de la classe</span>

        <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">tileLayer</span><span class="token punctuation">(</span><span class="token string">'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          attribution<span class="token punctuation">:</span> <span class="token string">'Map data &amp;copy; &lt;a href=&quot;https://www.openstreetmap.org/&quot;&gt;OpenStreetMap&lt;/a&gt; contributors'</span><span class="token punctuation">,</span>
          scrollwheelzoom<span class="token punctuation">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_map<span class="token punctuation">)</span>

        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// END</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">center</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_map<span class="token punctuation">.</span><span class="token function">fitBounds</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_bounds<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Il ne me reste plus qu'à instancier un objet avec ma classe et faire appel à la méthode load de ce dernier pour afficher ma carte dans ma page html.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Fichier app.js</span>
<span class="token keyword">import</span> LeafletMap <span class="token keyword">from</span> <span class="token string">'LeafletMap.class.js'</span>

<span class="token keyword">var</span> $divMap <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LeafletMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

map<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>$divMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tout est okay !'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="afficher-les-trajets-dans-la-carte"><a href="#afficher-les-trajets-dans-la-carte" aria-hidden="true" class="header-anchor">#</a> Afficher les trajets dans la carte</h3> <p>Nous voici au point culminant de notre exercice. Maintenant il va être question d'afficher les trajets dans la carte.</p> <p>Pour cela, nous allons <strong>ajouter une méthode dans la classe LeafletMap</strong> qui va nous permettre de créer une <strong>Polyligne</strong> entre les différents points [lat, long] de notre trajet.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Fichier LeafletMap.class.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">LeafletMap</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

  <span class="token comment">// Instancier une carte dans l'élément passé en paramètre</span>
  <span class="token function">load</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

  <span class="token function">center</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

  <span class="token comment">// Créer un trajet dans la carte, en dessinant une ligne entre différents points</span>
  <span class="token function">addRoad</span> <span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_bounds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token constant">L</span><span class="token punctuation">.</span><span class="token function">polyline</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">,</span> <span class="token punctuation">{</span>color<span class="token punctuation">:</span> <span class="token string">'grey'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_map<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Maintenant, il ne vous suffit plus que de faire appel à cette méthode depuis le fichier app.js, tout en faisant passer en paramètre les coordonnées transmises par l'API. Dans l'exemple il s'agissait de la propriété <strong>geometry</strong> présente dans réponse de l'API.</p> <p>Selon que l'api vous envoie une polyline ou un tableau de coordonnées, on ne va pas pouvoir utiliser cette méthode de la même manières. Voilà comment je procède:</p> <h4 id="si-nous-avons-un-geojson"><a href="#si-nous-avons-un-geojson" aria-hidden="true" class="header-anchor">#</a> Si nous avons un GeoJson</h4> <p>Là il suffit de récupérer le tableau des cordonnées gps représentant les points de passage et le placer en paramètre de notre méthode map.addRoad();</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Fichier app.js</span>
<span class="token keyword">import</span> LeafletMap <span class="token keyword">from</span> <span class="token string">'LeafletMap.class.js'</span>

<span class="token keyword">const</span> maRoute <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token comment">// &lt;-- La réponse de l'API est stockée ici</span>

<span class="token keyword">var</span> $divMap <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LeafletMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

map<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>$divMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  map<span class="token punctuation">.</span><span class="token function">addRoad</span><span class="token punctuation">(</span>maRoute<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tout est okay !'</span><span class="token punctuation">)</span>

  map<span class="token punctuation">.</span><span class="token function">center</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="si-nous-avons-une-polyline"><a href="#si-nous-avons-une-polyline" aria-hidden="true" class="header-anchor">#</a> Si nous avons une polyline</h4> <p>Dans le cas ou vous avez une polyline, vous allez devoir convertir la chaine de caractère <strong>en coordonnées Gps</strong>. C'est là que j'ai découvert un module de Mapbox qui permet d'encoder ou de décoder des cordonnées. Rendez vous sur le <a href="https://github.com/mapbox/polyline/" target="_blank" rel="noopener noreferrer">repository de Mapbox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> pour pouvoir la rajouter dans vos dépendances.</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm install @mapbox/polyline --save
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Fichier app.js</span>
<span class="token keyword">import</span> LeafletMap <span class="token keyword">from</span> <span class="token string">'LeafletMap.class.js'</span>
<span class="token keyword">import</span> polyline <span class="token keyword">from</span> <span class="token string">'@mapbox/polyline'</span>

<span class="token keyword">const</span> maRoute <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token comment">// &lt;-- La réponse de l'API est stockée ici</span>

<span class="token keyword">var</span> $divMap <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LeafletMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

map<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>$divMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  map<span class="token punctuation">.</span><span class="token function">addRoad</span><span class="token punctuation">(</span>polyline<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>maRoute<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tout est okay !'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>ET VOILA votre route devrait s'afficher dans votre carte !</p> <div class="warning custom-block"><p class="custom-block-title">Quand un trajet en voiture dans le sud de la France se transforme en safari Africain.</p> <p>🦁 Certaines librairies et api n'ont pas le même système de projection ni même la même façon de formaliser les coordonnées gps.</p> <p>Certaines comme Leaflet sont de la forme suivante [lat, long] et d'autres comme Mapbox sont comme ça [long, lat]. Cet <a href="https://macwright.org/lonlat/" target="_blank" rel="noopener noreferrer">article de Mac wright<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> recense les différentes librairies et leurs formats de coordonnées GPS respectifs.</p></div></div> <aside class="page-infos columns"><div class="column col-6 page-infos-l"><div class="signature"><div class="signature-head"><div class="signature-head-picture avatar avatar-xl"><img src="https://websylvain.com/img/avatars/pastor-sylvain-avatar.jpg" alt="Sylvain Pastor"> <i class="avatar-presence online"></i></div> <p class="signature-head-title">Écrit par <a href="/a-propos/auteurs/sylvain-pastor.html">Sylvain Pastor</a> <br>le <span>2018-08-09T00:00:00.000Z</span></p></div> <div class="signature-description"><p><small>Développeur web Freelance dans le sud de la France... Je recherche le code source du bonheur dans le monde du travail.</small></p></div></div></div> <div class="column col-6 page-infos-r"><div><p>Partagez cet article sur les réseaux sociaux</p> <ul class="share-links"><li><a target="_blank" href="http://www.facebook.com/sharer.php?u=https://websylvain.com/posts/case-study/sig-annuaire-balade.html"><i class="fa fa-facebook-f"></i></a></li> <li><a target="_blank" href="https://twitter.com/share?url=https://websylvain.com/posts/case-study/sig-annuaire-balade.html&amp;text=Prototyper un roadbook en JavaScript&amp;hashtags=webdev,blogging,freelance"><i class="fa fa-twitter"></i></a></li> <li><a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://websylvain.com/posts/case-study/sig-annuaire-balade.html"><i class="fa fa-linkedin"></i></a></li> <li><a target="_blank" href="http://reddit.com/submit?url=https://websylvain.com/posts/case-study/sig-annuaire-balade.html&amp;title=Prototyper un roadbook en JavaScript"><i class="fa fa-reddit"></i></a></li> <li><a target="_blank" href="https://plus.google.com/share?url=https://websylvain.com/posts/case-study/sig-annuaire-balade.html"><i class="fa fa-google-plus"></i></a></li> <li><a href="mailto:?Subject=Prototyper un roadbook en JavaScript&amp;Body=https://websylvain.com/posts/case-study/sig-annuaire-balade.html"><i class="fa fa-envelope"></i></a></li></ul></div></div></aside> <footer class="post-comments"><div class="disqus-comments"><div id="disqus_thread"></div> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></footer> </article> <div class="sidebar column col-lg-12 col-4"> <ul class="sidebar-links nav"><li class="nav-item"><div class="sidebar-group first"><h3 class="sidebar-heading open"><span>Les derniers cas étudié</span> <!----></h3> <ul class="sidebar-group-items nav"><li class="nav-item"><a href="/posts/case-study/sig-annuaire-balade.html" class="active sidebar-link">Prototyper un roadbook en JavaScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/posts/case-study/sig-annuaire-balade.html#_1-obtenir-les-donnees-geographiques-d-un-itineraire-entre-plusieurs-points" class="sidebar-link">1 / Obtenir les données géographiques d'un itinéraire entre plusieurs points</a></li><li class="sidebar-sub-header"><a href="/posts/case-study/sig-annuaire-balade.html#_2-leaflet-la-carte" class="sidebar-link">2 / Leaflet, la carte</a></li></ul></li></ul></div></li><li class="nav-item"><div class="sidebar-group"><h3 class="sidebar-heading"><span>Les derniers articles</span> <!----></h3> <ul class="sidebar-group-items nav"><li class="nav-item"><a href="/posts/seo-vuejs-spa.html" class="sidebar-link">Comment gérer le référencement naturel avec Vuejs ?</a></li><li class="nav-item"><a href="/posts/software-craftmanship-definition.html" class="sidebar-link">Manifeste du software craftmanship</a></li><li class="nav-item"><a href="/posts/bonnes-mauvaises-habitudes-developpeur-web.html" class="sidebar-link">De bonnes habitudes en communication en tant que Dev !</a></li><li class="nav-item"><a href="/posts/utiliser-plugin-pwa-vue-cli-3.html" class="sidebar-link">Comment utiliser le plugin PWA dans Vue CLI 3.0</a></li><li class="nav-item"><a href="/posts/developpeur-web-partenaria-jooble.html" class="sidebar-link">Je suis un Dévéloppeur Web, comment trouver un emploi?</a></li></ul></div></li></ul> </div></section> <footer class="footer"><div class="copyright_left">© 2018 by Websylvain. All rights reserved.</div></footer></section> <aside class="rigth-nav"><a href="#about" class="page-scroll">SCROLL  <i aria-hidden="true" class="fa fa-long-arrow-right"></i></a></aside></main><div class="global-ui"></div></div>
    <script src="/assets/js/app.be567602.js" defer></script><script src="/assets/js/4.e64471fe.js" defer></script><script src="/assets/js/1.81f9b116.js" defer></script><script src="/assets/js/25.cfb88f80.js" defer></script>
  </body>
</html>
